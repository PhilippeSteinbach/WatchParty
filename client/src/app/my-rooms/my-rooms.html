<div class="max-w-2xl mx-auto py-8 px-4">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-bold gradient-text">My Rooms</h2>
    <a routerLink="/" [queryParams]="{view: 'create'}" class="btn-gradient inline-flex items-center gap-1.5 text-sm px-4 py-2">
      <lucide-icon [img]="PlusIcon" [size]="16"></lucide-icon>
      Create Room
    </a>
  </div>

  @if (loading()) {
    <p class="text-purple-300/60">Loadingâ€¦</p>
  } @else if (error()) {
    <p class="text-neon-red">{{ error() }}</p>
  } @else if (rooms().length === 0) {
    <p class="text-purple-300/60">You don't have any permanent rooms yet.</p>
  } @else {
    <ul class="flex flex-col gap-3">
      @for (room of rooms(); track room.id) {
        <li class="card-glow p-4 flex items-center justify-between">
          <div class="flex flex-col gap-1 min-w-0 flex-1 mr-3">
            @if (editingCode() === room.code) {
              <form class="flex items-center gap-2" (ngSubmit)="saveRename()">
                <input
                  type="text"
                  class="input-dark text-sm py-1 px-2 flex-1 min-w-0"
                  [ngModel]="editingName()"
                  (ngModelChange)="editingName.set($event)"
                  name="roomName"
                  maxlength="100"
                  autofocus
                  (keydown.escape)="cancelEditing()"
                />
                <button type="submit" class="p-1 rounded-md text-neon-green hover:bg-neon-green/10 transition-colors cursor-pointer" aria-label="Save">
                  <lucide-icon [img]="CheckIcon" [size]="16"></lucide-icon>
                </button>
                <button type="button" class="p-1 rounded-md text-purple-400/50 hover:text-neon-red hover:bg-neon-red/10 transition-colors cursor-pointer" (click)="cancelEditing()" aria-label="Cancel">
                  <lucide-icon [img]="XIcon" [size]="16"></lucide-icon>
                </button>
              </form>
            } @else {
              <span class="text-purple-100 font-semibold flex items-center gap-1.5">
                {{ room.name }}
                <button
                  class="p-0.5 rounded text-purple-400/30 hover:text-neon-purple transition-colors cursor-pointer"
                  (click)="startEditing(room)"
                  aria-label="Rename room">
                  <lucide-icon [img]="PencilIcon" [size]="14"></lucide-icon>
                </button>
              </span>
            }
            <span class="text-purple-400/50 font-mono text-xs">#{{ room.code }}</span>
          </div>
          <div class="flex items-center gap-2">
            <a class="btn-gradient text-sm px-3 py-1.5" [routerLink]="['/room', room.code]">Join</a>
            <button
              class="text-sm px-3 py-1.5 rounded-lg border border-border text-purple-400/50 hover:text-neon-red hover:border-neon-red hover:bg-neon-red/10 transition-colors cursor-pointer"
              (click)="confirmDelete(room.code)"
              aria-label="Delete room">
              <lucide-icon [img]="Trash2Icon" [size]="16"></lucide-icon>
            </button>
          </div>
        </li>
      }
    </ul>
  }
</div>

@if (confirmDeleteCode()) {
  <div class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center"
       (click)="cancelDelete()" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="card-glow p-6 max-w-sm w-[90%] flex flex-col gap-3" (click)="$event.stopPropagation()">
      <div class="flex items-center gap-2">
        <lucide-icon [img]="AlertTriangleIcon" [size]="20" class="text-neon-red"></lucide-icon>
        <h3 id="modal-title" class="text-purple-100 text-lg font-semibold">Delete Room?</h3>
      </div>
      <p class="text-purple-300/60 text-sm leading-relaxed">
        Are you sure you want to delete room <strong class="text-purple-100 font-mono">#{{ confirmDeleteCode() }}</strong>? This cannot be undone.
      </p>
      <div class="flex justify-end gap-2 mt-1">
        <button class="btn-ghost text-sm px-3 py-1.5" (click)="cancelDelete()">Cancel</button>
        <button class="bg-neon-red text-white text-sm font-semibold px-3 py-1.5 rounded-lg hover:bg-neon-red/80 transition-colors cursor-pointer"
                (click)="deleteRoom()">Delete</button>
      </div>
    </div>
  </div>
}
