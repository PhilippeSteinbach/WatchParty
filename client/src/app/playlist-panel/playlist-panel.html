<div class="flex flex-col h-full bg-surface-2 text-purple-100">
  <!-- Toolbar -->
  <div class="flex items-center justify-between px-3 py-2 border-b border-border">
    <div class="flex items-center gap-1">
      <button
        class="p-1.5 rounded transition-colors"
        [class]="playbackMode() === 'ORDERED' ? 'text-neon-purple bg-neon-purple/10' : 'text-purple-400/50 hover:text-purple-300'"
        (click)="setMode('ORDERED')"
        aria-label="Ordered playback"
        title="Ordered"
      >
        <lucide-icon [img]="ListOrdered" [size]="16"></lucide-icon>
      </button>
      <button
        class="p-1.5 rounded transition-colors"
        [class]="playbackMode() === 'SHUFFLE' ? 'text-neon-purple bg-neon-purple/10' : 'text-purple-400/50 hover:text-purple-300'"
        (click)="setMode('SHUFFLE')"
        aria-label="Shuffle playback"
        title="Shuffle"
      >
        <lucide-icon [img]="Shuffle" [size]="16"></lucide-icon>
      </button>
    </div>
    <div class="flex items-center gap-1">
      <button
        class="p-1.5 rounded transition-colors"
        [class]="searchOpen() ? 'text-neon-blue bg-neon-blue/10' : 'text-purple-400/50 hover:text-purple-300'"
        (click)="toggleSearch()"
        aria-label="Search playlist"
        title="Search"
      >
        <lucide-icon [img]="Search" [size]="16"></lucide-icon>
      </button>
      <button
        class="p-1.5 rounded text-purple-400/50 hover:text-neon-green transition-colors"
        (click)="skipToNext()"
        aria-label="Play next"
        title="Play next"
      >
        <lucide-icon [img]="SkipForward" [size]="16"></lucide-icon>
      </button>
    </div>
  </div>

  @if (searchOpen()) {
    <div class="px-3 py-2 border-b border-border">
      <input
        type="text"
        class="input-dark text-sm w-full"
        placeholder="Search by title…"
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event)"
        name="searchQuery"
        aria-label="Search playlist"
      />
    </div>
  }

  <div
    class="flex-1 overflow-y-auto p-2"
    role="list"
    cdkDropList
    (cdkDropListDropped)="onDrop($event)"
  >
    @for (item of filteredItems(); track item.id) {
      <div
        class="playlist-item flex items-center gap-2 p-2 rounded-lg hover:bg-surface-4 transition-colors"
        [class.now-playing]="isCurrentlyPlaying(item)"
        role="listitem"
        cdkDrag
      >
        <span class="text-purple-400/40 cursor-grab shrink-0" cdkDragHandle>
          <lucide-icon [img]="GripVertical" [size]="14"></lucide-icon>
        </span>
        @if (thumbnailFor(item); as thumb) {
          <img
            class="w-12 h-9 rounded object-cover shrink-0"
            [src]="thumb"
            [alt]="displayTitle(item)"
          />
        }
        <div class="flex-1 min-w-0 flex flex-col gap-0.5">
          <span class="text-sm truncate">{{ displayTitle(item) }}</span>
          <span class="text-xs text-purple-400/50">
            {{ item.addedBy }} · {{ formatDuration(item.durationSeconds) }}
          </span>
        </div>
        <button
          class="shrink-0 p-1 rounded text-purple-300/60 hover:text-neon-green transition-colors"
          (click)="playItem(item)"
          aria-label="Play now"
        >
          <lucide-icon [img]="Play" [size]="14"></lucide-icon>
        </button>
        <button
          class="shrink-0 p-1 rounded text-purple-300/60 hover:text-neon-red transition-colors"
          (click)="removeItem(item.id)"
          aria-label="Remove item"
        >
          <lucide-icon [img]="X" [size]="14"></lucide-icon>
        </button>
      </div>
    } @empty {
      <p class="text-center text-purple-400/30 py-8 text-sm">No items in playlist</p>
    }
  </div>
</div>
